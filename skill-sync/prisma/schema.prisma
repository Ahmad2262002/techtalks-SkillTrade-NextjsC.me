generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  industry      String?
  bio           String?
  avatarUrl     String?
  phoneNumber   String?
  createdAt     DateTime  @default(now())
  skills        UserSkill[]
  proposals     Proposal[]    @relation("ProposalOwner")
  applications  Application[] @relation("Applicant")
  swapsAsTeacher  Swap[]      @relation("Teacher")
  swapsAsStudent  Swap[]      @relation("Student")
  reviewsReceived Review[]    @relation("ReviewReceiver")
  reviewsGiven    Review[]    @relation("ReviewAuthor")
}

model Skill {
  id            String    @id @default(cuid())
  name          String    @unique
  users         UserSkill[]
  neededIn      Proposal[] 
  offeredIn     Proposal[] @relation("OfferedSkills") 
}

model UserSkill {
  id        String   @id @default(cuid())
  userId    String
  skillId   String
  user      User     @relation(fields: [userId], references: [id])
  skill     Skill    @relation(fields: [skillId], references: [id])
  source    SkillSource @default(MANUAL)
  isVisible Boolean     @default(true)
  endorsementCount Int  @default(0)
  @@unique([userId, skillId])
}

enum SkillSource {
  MANUAL
  ENDORSED
}

model Proposal {
  id          String   @id @default(cuid())
  ownerId     String
  owner       User     @relation("ProposalOwner", fields: [ownerId], references: [id])
  title       String
  description String
  modality    String   
  status      ProposalStatus @default(OPEN)
  createdAt   DateTime @default(now())
  offeredSkills Skill[] @relation("OfferedSkills")
  neededSkills  Skill[]
  applications  Application[]
  swaps         Swap[]
}

enum ProposalStatus {
  OPEN
  IN_PROGRESS
  CLOSED
}

model Application {
  id          String   @id @default(cuid())
  proposalId  String
  applicantId String
  proposal    Proposal @relation(fields: [proposalId], references: [id])
  applicant   User     @relation("Applicant", fields: [applicantId], references: [id])
  pitchMessage String
  status       ApplicationStatus @default(PENDING)
  createdAt    DateTime @default(now())
  @@unique([proposalId, applicantId])
}

enum ApplicationStatus {
  PENDING
  ACCEPTED
  REJECTED
}

model Swap {
  id          String   @id @default(cuid())
  proposalId  String
  proposal    Proposal @relation(fields: [proposalId], references: [id])
  teacherId   String
  studentId   String
  teacher     User     @relation("Teacher", fields: [teacherId], references: [id])
  student     User     @relation("Student", fields: [studentId], references: [id])
  status      SwapStatus @default(ACTIVE)
  startedAt   DateTime   @default(now())
  completedAt DateTime?
  reviews     Review[]
}

enum SwapStatus {
  ACTIVE
  COMPLETED
  CANCELLED
}

model Review {
  id          String   @id @default(cuid())
  swapId      String
  swap        Swap     @relation(fields: [swapId], references: [id])
  authorId    String
  author      User     @relation("ReviewAuthor", fields: [authorId], references: [id])
  receiverId  String
  receiver    User     @relation("ReviewReceiver", fields: [receiverId], references: [id])
  rating      Int
  comment     String?
  createdAt   DateTime @default(now())
}